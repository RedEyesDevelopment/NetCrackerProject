<div class="container">

    <ng-include src="'app/admin/template/aside.html'"></ng-include>

    <div class="workspace col-sm-10">

        <!-- Top of workspace -->
        <div class="top col-sm-12">
            <h2>Users</h2>
            <button class="btn btn-primary btn-md newEntity" ng-click="prepareToAddUser()">New user</button>
        </div>
        <ng-include src="'app/admin/template/serverError.html'"></ng-include>

        <!-- List of objects in workspace -->
        <div class="listOfObjects" ng-if="!modificationMode">
            <ul class="pager">
                <li><a ng-click="previousUsers()"><i class="fa fa-chevron-left" aria-hidden="true"></i></a></li>
                <li><input type="number" min="1" max="999" ng-model="pager.objectsOnPage"></li>
                <li><a ng-click="nextUsers()"><i class="fa fa-chevron-right" aria-hidden="true"></i></a></li>
            </ul>
            <div ng-repeat="user in listOfUsers | orderBy : 'role' | limitTo : pager.objectsOnPage : pager.startPaging" class="col-sm-4 admin-notes">
                <div class="block-border">
                    <p> Last Name: {{ user.lastName }} </p>
                    <p class="top-bottom-border"> First Name: {{ user.firstName }} </p>
                    <p> Role: {{ user.role.roleName }} </p>
                    <p class="top-bottom-border"> Email: {{ user.email }} </p>
                    <p> Additional info: {{ user.additionalInfo }} </p>
                    <p class="top-border"> Enabled: {{ user.enabled }} </p>
                    <div ng-repeat="phone in user.phones" class="top-border">
                        <p> Phone: {{ phone.phoneNumber }} </p>
                    </div>
                    <div class="text-right">
                        <button type="button" class="btn btn-primary btn-md"
                                ng-click="prepareToEditUser(user.objectId, listOfUsers.indexOf(user))">
                            Edit
                        </button>
                        <button type="button" class="btn btn-warning btn-md"
                                ng-click="prepareToDeleteUser(user.objectId, listOfUsers.indexOf(user))"
                                data-toggle="modal" data-target="#deleteConfirmModal">
                            Delete
                        </button>
                    </div>
                </div>
            </div>
        </div>


        <!-- Form for add or edit -->
        <div class="editWindow" ng-if="modificationMode">
            <div>
                <button ng-click="back()" class="btn btn-info btn-sm back">
                    <i class="fa fa-long-arrow-left" aria-hidden="true"></i> Back to users
                </button>

                <div class="answer">
                    <!-- Successfully added -->
                    <div ng-if="added">
                        Successfully added! <i class="fa fa-check" aria-hidden="true"></i>
                    </div>

                    <!-- Successfully updated -->
                    <div ng-if="stage == 'updated'">
                        Successfully updated! <i class="fa fa-check" aria-hidden="true"></i>
                    </div>
                </div>

            </div>
            <div class="err" ng-if=" stage == 'invalidInputData'">
                Password and confirm password not equals! <i class="fa fa-times" aria-hidden="true"></i>
            </div>
            <div class="col-sm-offset-3 col-sm-5 createUpdateForm">
                <form class="form-horizontal" name="createUpdateForm">
                    <div class="form-group">
                        <label for="lastName" class="col-sm-6 control-label">First Name</label>
                        <div class="col-sm-6">
                            <input type="text" id="lastName" ng-required="true" ng-model="user.lastName">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="firstName" class="col-sm-6 control-label">Last Name</label>
                        <div class="col-sm-6">
                            <input type="text" id="firstName" ng-required="true" ng-model="user.firstName">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="role" class="col-sm-6 control-label">Role</label>
                        <div class="col-sm-6">
                            <select id="role" class="form-control" ng-required="true" ng-model="user.role"
                                    ng-options="role.objectId as role.roleName for role in listOfRoles">
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="email" class="col-sm-6 control-label">Email</label>
                        <div class="col-sm-6">
                            <input type="text" id="email" ng-required="true" ng-model="user.email"
                                   ng-pattern = '/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i'>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="password" class="col-sm-6 control-label">Password</label>
                        <div class="col-sm-6">
                            <input type="password" id="password" ng-required="true" ng-model="user.password"
                                   ng-pattern="/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,}$/">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="confirm" class="col-sm-6 control-label">Confirm password</label>
                        <div class="col-sm-6">
                            <input type="password" id="confirm" ng-required="true" ng-model="user.confirm"
                                   ng-pattern="/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,}$/">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="phone" class="col-sm-6 control-label">Phone </label>
                        <div class="col-sm-6">
                            <input type="text" id="phone" ng-required="true" ng-model="user.phone"
                                   ng-pattern="/^\+\d{1,2}\(\d{3}\)\d{2}\-\d{2}\-\d{3}$|^\+\d{12}$|^\d{7}$|^[0]\d{9}$/">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="additionalInfo" class="col-sm-6 control-label">Additional info</label>
                        <div class="col-sm-6">
                            <input type="text" id="additionalInfo" ng-required="true" ng-model="user.additionalInfo">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="enabled" class="col-sm-6 control-label">Enables</label>
                        <div class="col-sm-3">
                            <select id="enabled" class="form-control" ng-required="true" ng-model="user.enabled"
                                    ng-options="enb for enb in enabled">
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="text-center">
                            <button class="btn btn-primary" ng-disabled="createUpdateForm.$invalid" data-toggle="modal" data-target="#editConfirmModal">OK</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


<ng-include src="'app/admin/template/confirmModalWindows.html'"></ng-include>